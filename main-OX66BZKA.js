import{a as l}from"./chunk-5GEGBKO5.js";import{a as ye}from"./chunk-HC6ADQJT.js";import{a as ge,c as be,d as c,e as R,f as Ce,g as we}from"./chunk-ZR6YA4GW.js";import{$a as E,B as C,Da as m,Gb as fe,I as D,Ka as re,L as v,M as Y,Mb as he,Nb as ve,O as j,Oa as ie,Qa as V,R as J,S as W,Sa as se,T as a,Ta as ae,U as Q,Y as X,Ya as f,Z as ee,Za as w,_ as te,_a as y,a as Z,ab as b,bb as pe,cb as ce,da as oe,e as P,ea as ne,eb as H,fb as le,h as T,hb as d,ib as de,l as L,m as $,nb as ue,p as h,sa as _,sb as me,w as u,x as U,xa as B,y as q}from"./chunk-HDYZMK6E.js";var Ee=(t,r)=>{let e=a(l),o=a(c);return e.hasToken()?(o.navigate(["/profile"]),!1):!0};var G=(t,r)=>a(l).hasToken()?!0:(a(c).navigate(["/login"]),!1);var Se=()=>{let t=a(ye),r=a(l),e=a(c);return t.getProfile().pipe(q(o=>o.status===401?(r.removeToken(),e.navigateByUrl("/home"),L(null)):(console.error("Profile load error:",o),L(null))))};var Me=[{path:"",redirectTo:"/home",pathMatch:"full"},{path:"home",loadComponent:()=>import("./chunk-GAKB77OS.js").then(t=>t.HomeComponent),canActivate:[Ee]},{path:"profile",loadComponent:()=>import("./chunk-DJYNB4CC.js").then(t=>t.ProfileComponent),resolve:{profile:Se},canActivate:[G]},{path:"login",loadComponent:()=>import("./chunk-QT3RDMC3.js").then(t=>t.LoginComponent)},{path:"signup",loadComponent:()=>import("./chunk-AJEQE6YT.js").then(t=>t.SignupComponent)},{path:"books",loadComponent:()=>import("./chunk-FLPQXOFS.js").then(t=>t.BooksComponent),canActivate:[G]},{path:"**",loadComponent:()=>import("./chunk-6T3BGBB4.js").then(t=>t.NotFoundComponent)}];var K="Service workers are disabled or not supported by this browser",S=class{serviceWorker;worker;registration;events;constructor(r,e){if(this.serviceWorker=r,!r)this.worker=this.events=this.registration=new P(o=>o.error(new v(5601,!1)));else{let o=null,n=new T;this.worker=new P(p=>(o!==null&&p.next(o),n.subscribe(O=>p.next(O))));let s=()=>{let{controller:p}=r;p!==null&&(o=p,n.next(o))};r.addEventListener("controllerchange",s),s(),this.registration=this.worker.pipe(D(()=>r.getRegistration().then(p=>{if(!p)throw new v(5601,!1);return p})));let i=new T;this.events=i.asObservable();let g=p=>{let{data:O}=p;O?.type&&i.next(O)};r.addEventListener("message",g),e?.get(V,null,{optional:!0})?.onDestroy(()=>{r.removeEventListener("controllerchange",s),r.removeEventListener("message",g)})}}postMessage(r,e){return new Promise(o=>{this.worker.pipe(C(1)).subscribe(n=>{n.postMessage(Z({action:r},e)),o()})})}postMessageWithOperation(r,e,o){let n=this.waitForOperationCompleted(o),s=this.postMessage(r,e);return Promise.all([s,n]).then(([,i])=>i)}generateNonce(){return Math.round(Math.random()*1e7)}eventsOfType(r){let e;return typeof r=="string"?e=o=>o.type===r:e=o=>r.includes(o.type),this.events.pipe(U(e))}nextEventOfType(r){return this.eventsOfType(r).pipe(C(1))}waitForOperationCompleted(r){return new Promise((e,o)=>{this.eventsOfType("OPERATION_COMPLETED").pipe(U(n=>n.nonce===r),C(1),h(n=>{if(n.result!==void 0)return n.result;throw new Error(n.error)})).subscribe({next:e,error:o})})}get isEnabled(){return!!this.serviceWorker}},_e=(()=>{class t{sw;messages;notificationClicks;notificationCloses;pushSubscriptionChanges;subscription;get isEnabled(){return this.sw.isEnabled}pushManager=null;subscriptionChanges=new T;constructor(e){if(this.sw=e,!e.isEnabled){this.messages=u,this.notificationClicks=u,this.notificationCloses=u,this.pushSubscriptionChanges=u,this.subscription=u;return}this.messages=this.sw.eventsOfType("PUSH").pipe(h(n=>n.data)),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(h(n=>n.data)),this.notificationCloses=this.sw.eventsOfType("NOTIFICATION_CLOSE").pipe(h(n=>n.data)),this.pushSubscriptionChanges=this.sw.eventsOfType("PUSH_SUBSCRIPTION_CHANGE").pipe(h(n=>n.data)),this.pushManager=this.sw.registration.pipe(h(n=>n.pushManager));let o=this.pushManager.pipe(D(n=>n.getSubscription()));this.subscription=new P(n=>{let s=o.subscribe(n),i=this.subscriptionChanges.subscribe(n);return()=>{s.unsubscribe(),i.unsubscribe()}})}requestSubscription(e){if(!this.sw.isEnabled||this.pushManager===null)return Promise.reject(new Error(K));let o={userVisibleOnly:!0},n=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),s=new Uint8Array(new ArrayBuffer(n.length));for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);return o.applicationServerKey=s,new Promise((i,g)=>{this.pushManager.pipe(D(M=>M.subscribe(o)),C(1)).subscribe({next:M=>{this.subscriptionChanges.next(M),i(M)},error:g})})}unsubscribe(){if(!this.sw.isEnabled)return Promise.reject(new Error(K));let e=o=>{if(o===null)throw new v(5602,!1);return o.unsubscribe().then(n=>{if(!n)throw new v(5603,!1);this.subscriptionChanges.next(null)})};return new Promise((o,n)=>{this.subscription.pipe(C(1),D(e)).subscribe({next:o,error:n})})}decodeBase64(e){return atob(e)}static \u0275fac=function(o){return new(o||t)(W(S))};static \u0275prov=j({token:t,factory:t.\u0275fac})}return t})(),Re=(()=>{class t{sw;versionUpdates;unrecoverable;get isEnabled(){return this.sw.isEnabled}ongoingCheckForUpdate=null;constructor(e){if(this.sw=e,!e.isEnabled){this.versionUpdates=u,this.unrecoverable=u;return}this.versionUpdates=this.sw.eventsOfType(["VERSION_DETECTED","VERSION_INSTALLATION_FAILED","VERSION_READY","NO_NEW_VERSION_DETECTED","VERSION_FAILED"]),this.unrecoverable=this.sw.eventsOfType("UNRECOVERABLE_STATE")}checkForUpdate(){if(!this.sw.isEnabled)return Promise.reject(new Error(K));if(this.ongoingCheckForUpdate)return this.ongoingCheckForUpdate;let e=this.sw.generateNonce();return this.ongoingCheckForUpdate=this.sw.postMessageWithOperation("CHECK_FOR_UPDATES",{nonce:e},e).finally(()=>{this.ongoingCheckForUpdate=null}),this.ongoingCheckForUpdate}activateUpdate(){if(!this.sw.isEnabled)return Promise.reject(new v(5601,!1));let e=this.sw.generateNonce();return this.sw.postMessageWithOperation("ACTIVATE_UPDATE",{nonce:e},e)}static \u0275fac=function(o){return new(o||t)(W(S))};static \u0275prov=j({token:t,factory:t.\u0275fac})}return t})();var ke=new J("");function xe(){let t=a(k);if(!("serviceWorker"in navigator&&t.enabled!==!1))return;let r=a(ke),e=a(re),o=a(V);e.runOutsideAngular(()=>{let n=navigator.serviceWorker,s=()=>n.controller?.postMessage({action:"INITIALIZE"});n.addEventListener("controllerchange",s),o.onDestroy(()=>{n.removeEventListener("controllerchange",s)})}),e.runOutsideAngular(()=>{let n,{registrationStrategy:s}=t;if(typeof s=="function")n=new Promise(i=>s().subscribe(()=>i()));else{let[i,...g]=(s||"registerWhenStable:30000").split(":");switch(i){case"registerImmediately":n=Promise.resolve();break;case"registerWithDelay":n=De(+g[0]||0);break;case"registerWhenStable":n=Promise.race([o.whenStable(),De(+g[0])]);break;default:throw new v(5600,!1)}}n.then(()=>{o.destroyed||navigator.serviceWorker.register(r,{scope:t.scope,updateViaCache:t.updateViaCache,type:t.type}).catch(i=>console.error(Y(5604,!1)))})})}function De(t){return new Promise(r=>setTimeout(r,t))}function Ie(t,r){return new S(t.enabled!==!1?navigator.serviceWorker:void 0,r)}var k=class{enabled;updateViaCache;type;scope;registrationStrategy};function Oe(t,r={}){return Q([_e,Re,{provide:ke,useValue:t},{provide:k,useValue:r},{provide:S,useFactory:Ie,deps:[k,te]},ie(xe)])}var Pe=(t,r)=>{let e=a(c),o=a(l),n=t.url||"";if(/\/(login|signup|home)(\/|$)/i.test(n))return r(t);if(!o.token)return console.warn("Blocking request \u2014 no auth token"),e.navigate(["/login"]),$(()=>new Error("No auth token"));let i=t.clone({setHeaders:{Authorization:`Bearer ${o.token}`}});return r(i)};var Te={providers:[he(ve([Pe])),oe(),ue(),Ce(Me),Oe("ngsw-worker.js",{enabled:!me(),registrationStrategy:"registerWhenStable:30000"})]};function Ne(t,r){if(t&1){let e=ce();E(0,"div",7)(1,"button",8),H("click",function(){X(e);let n=le();return ee(n.logout())}),d(2,"Logout"),b()()}}var I=class t{constructor(r,e){this.router=r;this.authService=e}isDropdownOpen=!1;toggleDropdown(){this.isDropdownOpen=this.authService.hasToken()?!this.isDropdownOpen:!1}logout(){this.authService.removeToken(),this.isDropdownOpen=!1,this.router.navigate(["/"])}static \u0275fac=function(e){return new(e||t)(B(c),B(l))};static \u0275cmp=m({type:t,selectors:[["top-panel"]],decls:11,vars:1,consts:[[1,"search-bar"],["type","search","placeholder","Search..."],[1,"user-info"],[1,"language"],[1,"notifications"],[1,"dropdown"],[1,"user-profile",3,"click"],[1,"dropdown-menu"],[1,"dropdown-item",3,"click"]],template:function(e,o){e&1&&(E(0,"div",0),pe(1,"input",1),b(),E(2,"div",2)(3,"span",3),d(4,"\u{1F1EC}\u{1F1E7}"),b(),E(5,"span",4),d(6,"\u{1F514}"),b(),E(7,"div",5)(8,"span",6),H("click",function(){return o.toggleDropdown()}),d(9,"\u{1F464}"),b(),se(10,Ne,3,0,"div",7),b()()),e&2&&(_(10),ae(o.isDropdownOpen?10:-1))},dependencies:[fe],styles:["[_nghost-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background-color:#fff;border-bottom:1px solid #e0e0e0}.search-bar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem 1rem;border:1px solid #eee;border-radius:6px;width:300px;background-color:#f8f9fa}.user-info[_ngcontent-%COMP%]{display:flex;gap:1.5rem;align-items:center}.dropdown[_ngcontent-%COMP%]{cursor:pointer;position:relative}.dropdown-menu[_ngcontent-%COMP%]{position:absolute;top:100%;right:0;background:#fff;box-shadow:0 2px 4px #0000001a;border-radius:4px;padding:.5rem 0;min-width:120px}.dropdown-item[_ngcontent-%COMP%]{display:block;width:100%;padding:.5rem 1rem;border:none;background:none;text-align:left;cursor:pointer}.dropdown-item[_ngcontent-%COMP%]:hover{background-color:#f8f9fa}"]})};var A=class t{title=ne("andreiucm");static \u0275fac=function(e){return new(e||t)};static \u0275cmp=m({type:t,selectors:[["app-logo"]],decls:3,vars:1,consts:[["routerLink","/",1,"logo-link"],[1,"logo"]],template:function(e,o){e&1&&(f(0,"a",0)(1,"div",1),d(2),w()()),e&2&&(_(2),de(o.title()))},dependencies:[we,R],styles:[".logo[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin-bottom:2rem}.logo-link[_ngcontent-%COMP%]{text-decoration:none;color:inherit}"]})};var N=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=m({type:t,selectors:[["primary-side-bar"]],decls:4,vars:0,consts:[[1,"nav-menu"],["routerLink","/books",1,"nav-item"]],template:function(e,o){e&1&&(y(0,"app-logo"),f(1,"nav",0)(2,"a",1),d(3,"Books"),w()())},dependencies:[A,R],styles:["[_nghost-%COMP%]{display:block;background-color:#fff;padding:1.5rem;border-right:1px solid #e0e0e0;height:100vh}.nav-item[_ngcontent-%COMP%]{display:block;padding:.75rem 1rem;color:#333;text-decoration:none;border-radius:.5rem}.nav-item[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}"]})};var F=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=m({type:t,selectors:[["app-root"]],decls:6,vars:0,consts:[[1,"layout"],[1,"main-container"],[1,"main-content"]],template:function(e,o){e&1&&(f(0,"div",0),y(1,"primary-side-bar"),f(2,"div",1),y(3,"top-panel"),f(4,"main",2),y(5,"router-outlet"),w()()())},dependencies:[be,I,N],styles:["[_nghost-%COMP%]{display:block;height:100vh}.layout[_ngcontent-%COMP%]{display:grid;grid-template-columns:280px 1fr;height:100vh;background-color:#f8f9fa}.main-container[_ngcontent-%COMP%]{display:grid;grid-template-rows:auto 1fr;min-height:0}.main-content[_ngcontent-%COMP%]{padding:2rem;overflow-y:auto;min-height:0}"]})};ge(F,Te).catch(t=>console.error(t));
